<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Ожившие фото: до и после</title>
  <meta name="description" content="Сравнение оригинальных фотографий и оживлённых видео. Адаптивно, быстро, удобно печатать.">
  <style>
    /* ===== ДИЗАЙН-ПЕРЕМЕННЫЕ ===== */
    :root {
      --bg: #f7f7fb;
      --card: #ffffff;
      --text: #1d1d22;
      --muted: #5a5f72;
      --accent-start: #667eea;
      --accent-end: #764ba2;
      --shadow: 0 10px 30px rgba(16, 24, 40, 0.08);
      --radius: 16px;
      --radius-sm: 12px;
      --gap: 20px;
      --maxw: 1200px;
      --ratio: 3 / 4; /* более высокое окно предпросмотра */
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0e0f13;
        --card: #14151b;
        --text: #e7e9ee;
        --muted: #a4aaba;
        --shadow: 0 10px 30px rgba(0,0,0,0.5);
      }
    }

    /* ===== БАЗА ===== */
    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
      background: var(--bg); color: var(--text); line-height: 1.45;
    }

    a { color: inherit; }
    img, video { display: block; width: 100%; height: 100%; object-fit: contain; }

    /* ===== ШАПКА ===== */
    header {
      background: linear-gradient(135deg, var(--accent-start), var(--accent-end));
      color: #fff; text-align: center; padding: 48px 16px;
    }
    header h1 { margin: 0 0 8px; font-size: clamp(28px, 4.5vw, 40px); letter-spacing: 0.2px; }
    header p { margin: 0; opacity: 0.9; }

    /* ===== КОНТЕНТ ===== */
    main { max-width: var(--maxw); margin: 0 auto; padding: 28px 16px 40px; }
    h2 { text-align: center; margin: 0 0 28px; color: var(--muted); font-weight: 600; }

    /* ===== СЕТКА ПАР ===== */
    .pairs {
      display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--gap);
    }

    .item { background: var(--card); border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; }
    .item-inner { display: grid; grid-template-columns: 1fr 1fr; gap: var(--gap); padding: var(--gap); }

    /* На мобильных стекаем */
    @media (max-width: 820px) { .item-inner { grid-template-columns: 1fr; } }

    .panel { display: grid; gap: 12px; }
    .panel h3 { margin: 0; font-size: 16px; color: var(--accent-start); letter-spacing: 0.2px; }

    /* Единое соотношение сторон для опрятности карточек */
    .media { position: relative; border-radius: var(--radius-sm); overflow: hidden; box-shadow: var(--shadow); background: #000; cursor: zoom-in; }
    .media::before { content: ""; display: block; aspect-ratio: var(--ratio); }
    .media > * { position: absolute; inset: 0; }

    /* Подписи / метаданные */
    figcaption { font-size: 12px; color: var(--muted); }

    /* Кнопки сверху карточки */
    .item-actions { display: flex; gap: 8px; align-items: center; justify-content: flex-end; padding: 0 var(--gap) var(--gap); }
    .btn {
      background: linear-gradient(135deg, var(--accent-start), var(--accent-end));
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 12px;
      cursor: pointer;
      box-shadow: var(--shadow);
      transition: transform .15s ease, filter .15s ease;
    }
    .btn:hover { transform: translateY(-1px); filter: brightness(1.05); }
    .btn:active { transform: translateY(0); filter: brightness(.95); }
    .btn:focus-visible { outline: 3px solid rgba(102,126,234,.5); outline-offset: 2px; }
    .btn:focus-visible { outline: 3px solid rgba(102,126,234,.5); outline-offset: 2px; }

    /* Печать: каждый элемент с новой страницы, медиа максимально резкие */
    @media print {
      header, .item-actions { display: none !important; }
      .item { break-inside: avoid; box-shadow: none; border: 1px solid #ccc; }
      .media::before { aspect-ratio: auto; }
    }
    /* Лайтбокс */
    dialog#lightbox::backdrop { background: rgba(0,0,0,.6); }
    dialog#lightbox { border: none; padding: 0; background: transparent; }
    .lightbox-inner { position: fixed; inset: 0; background: rgba(0,0,0,.92); display: flex; align-items: center; justify-content: center; }
    .lightbox-content { width: min(95vw, 1600px); height: min(95vh, 900px); }
    .lightbox-content img, .lightbox-content video { width: 100%; height: 100%; object-fit: contain; }
  /* Оверлей */
    .overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; z-index: 9999; }
    .overlay.visible { display: flex; }
    .overlay-backdrop { position: absolute; inset: 0; background: rgba(0,0,0,.9); }
    .overlay-box { position: relative; width: min(95vw, 1600px); height: min(95vh, 900px); display: grid; grid-template-rows: 1fr auto; gap: 12px; }
    .overlay-content { width: 100%; height: 100%; }
    .overlay-content img, .overlay-content video { width: 100%; height: 100%; object-fit: contain; background: #000; border-radius: var(--radius-sm); box-shadow: var(--shadow); }
    .overlay-actions { display: flex; justify-content: center; }
    .overlay-close { position: absolute; top: -8px; right: -8px; width: 36px; height: 36px; border-radius: 999px; border: none; background: linear-gradient(135deg, var(--accent-start), var(--accent-end)); color: #fff; font-size: 22px; line-height: 1; cursor: pointer; box-shadow: var(--shadow); }
</style>
</head>
<body>
  <header>
    <h1>Живые воспоминания</h1>
    <p>Как было и как стало</p>
  </header>

  <main>

    <section class="pairs" aria-label="Список сравнений до/после">

      <!-- ПАРА 1 -->
      <article class="item" aria-label="Сравнение 1">
        <div class="item-inner">
          <figure class="panel">
            <h3>До</h3>
            <div class="media">$1</div>
            <button class="btn zoom-btn" type="button" aria-label="Увеличить">Увеличить</button></figure>

          <figure class="panel">
            <h3>После</h3>
            <div class="media">$1</div>
            <button class="btn zoom-btn" type="button" aria-label="Увеличить">Увеличить</button></figure>
        </div>
        
      </article>

      <!-- ПАРА 2 -->
      <article class="item" aria-label="Сравнение 2">
        <div class="item-inner">
          <figure class="panel">
            <h3>До</h3>
            <div class="media">$1</div>
            <button class="btn zoom-btn" type="button" aria-label="Увеличить">Увеличить</button></figure>

          <figure class="panel">
            <h3>После</h3>
            <div class="media">$1</div>
            <button class="btn zoom-btn" type="button" aria-label="Увеличить">Увеличить</button></figure>
        </div>
        
      </article>

      <!-- ПАРА 3 -->
      <article class="item" aria-label="Сравнение 3">
        <div class="item-inner">
          <figure class="panel">
            <h3>До</h3>
            <div class="media">$1</div>
            <button class="btn zoom-btn" type="button" aria-label="Увеличить">Увеличить</button></figure>

          <figure class="panel">
            <h3>После</h3>
            <div class="media">$1</div>
            <button class="btn zoom-btn" type="button" aria-label="Увеличить">Увеличить</button></figure>
        </div>
        
      </article>

      <!-- Добавляй новые пары по образцу -->

    </section>
  </main>

  <div id="overlay" class="overlay" aria-hidden="true">
    <div class="overlay-backdrop" data-close></div>
    <div class="overlay-box">
      <button class="overlay-close" type="button" aria-label="Закрыть" data-close>&times;</button>
      <div class="overlay-content" id="overlayContent"></div>
      <div class="overlay-actions">
        <button class="btn overlay-fullscreen" type="button" id="overlayFs">Во весь экран</button>
      </div>
    </div>
  </div>

  <script>
    // ===== ЛЕНИВАЯ ЗАГРУЗКА ВИДЕО =====
    const lazyVideos = document.querySelectorAll('video.lazy-video');
    const io = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          const video = entry.target;
          const source = video.querySelector('source[data-src]');
          if (source && !source.src) {
            source.src = source.dataset.src;
            video.load();
          }
          io.unobserve(video);
        }
      });
    }, { rootMargin: '200px 0px' });
    lazyVideos.forEach(v => io.observe(v));

    // ===== ЛАЙТБОКС-ОВЕРЛЕЙ БЕЗ <dialog> =====
    const overlay = document.getElementById('overlay');
    const overlayContent = document.getElementById('overlayContent');
    const overlayFsBtn = document.getElementById('overlayFs');

    function openOverlayFrom(node){
      overlayContent.innerHTML = '';
      let el;
      if (node.tagName.toLowerCase() === 'img') {
        el = document.createElement('img');
        el.src = node.currentSrc || node.src;
        el.alt = node.alt || 'Изображение';
      } else if (node.tagName.toLowerCase() === 'video') {
        el = document.createElement('video');
        el.controls = true;
        el.autoplay = true;
        el.playsInline = true;
        const source = node.querySelector('source');
        const src = (source && (source.dataset.src || source.src)) || node.currentSrc || node.src;
        if (src) el.src = src;
        if (node.poster) el.poster = node.poster;
      }
      if (!el) return;
      overlayContent.appendChild(el);
      overlay.classList.add('visible');
      overlay.setAttribute('aria-hidden', 'false');
    }

    function closeOverlay(){
      overlay.classList.remove('visible');
      overlay.setAttribute('aria-hidden', 'true');
      overlayContent.innerHTML = '';
      if (document.fullscreenElement && document.exitFullscreen) document.exitFullscreen();
    }

    document.addEventListener('click', e => {
      // Кнопка Увеличить
      const zoomBtn = e.target.closest('.zoom-btn');
      if (zoomBtn) {
        const panel = zoomBtn.closest('.panel');
        const media = panel && panel.querySelector('.media img, .media video');
        if (media) openOverlayFrom(media);
        return;
      }
      // Закрытие
      if (e.target.closest('[data-close]')) {
        closeOverlay();
      }
    });

    // Fullscreen для коробки оверлея (работает и на iOS для видео)
    overlayFsBtn.addEventListener('click', () => {
      const host = overlay.querySelector('.overlay-box');
      if (!document.fullscreenElement && host.requestFullscreen) host.requestFullscreen();
      else if (document.exitFullscreen) document.exitFullscreen();
    });
  </script>
  <dialog id="lightbox" aria-label="Просмотр в полный экран">
    <div class="lightbox-inner" data-close>
      <div class="lightbox-content" id="lightboxContent"></div>
    </div>
  </dialog>

</body>
</html>
